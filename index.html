<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flappy Cat Adventure</title>
<style>
  html, body {
    margin:0; padding:0; overflow:hidden;
    background: #fbeec1;
    font-family: Arial, sans-serif;
  }
  canvas {
    display:block;
    background-image: url('https://i.imgur.com/SviV5Nu.jpg');
    background-size: cover;
    touch-action: manipulation;
  }
  #startScreen {
    position: absolute;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.7);
    color: white;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 10;
  }
  #startScreen button {
    font-size: 24px;
    padding: 12px 30px;
    margin-top: 20px;
    cursor: pointer;
  }
  #loadingScreen {
    position: absolute;
    width: 100vw; height: 100vh;
    background: black;
    color: white;
    font-size: 24px;
    display: flex; align-items: center; justify-content: center;
    z-index: 20;
  }
</style>
</head>
<body>

<div id="loadingScreen">Loading images...</div>

<div id="startScreen" style="display:none;">
  <h1>Flappy Cat Adventure</h1>
  <p>Tap or press space to flap. Collect coins & toys!</p>
  <button onclick="startGame()">Start Game</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
resize();
window.addEventListener('resize', resize);

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

// Game Variables
let catX = 80, catY;
const catSize = 90;
let catVel = 0;
const gravity = 0.5;
const flapPower = -9;

let pipes = [];
let coins = [];
let toys = [];
let slobberBalls = [];
let barks = [];

let score = 0;
let highScore = localStorage.getItem('flappyCatHighScore') || 0;
let level = 1;
let gameOver = false;
let started = false;

let pipeSpeed = 3;
let pipeGap = 200;
const pipeWidth = 130;

const finalBossHealthMax = 20;
let finalBossHealth = finalBossHealthMax;
let finalBossActive = false;

// Images - preload and wait for them
const catImg = new Image();
catImg.src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRS0IQhVr9DDJCq61QX28zCoiqDrvezBh5ylw&s';

const dogImgsSrc = [
  'https://i.imgur.com/t4RYAxG.png',  // cute dog 1
  'https://i.imgur.com/zfrkV7n.png',  // cute dog 2
];

const dogImages = [];
let imagesLoaded = 0;
const totalImagesToLoad = 6;

const coinImg = new Image();
coinImg.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Gold_coin_icon.png/600px-Gold_coin_icon.png';

const toyImg = new Image();
toyImg.src = 'https://icons.iconarchive.com/icons/google/noto-emoji-animals-nature/48/22215-dog-face-icon.png';

const dogBossImg = new Image();
dogBossImg.src = 'https://i.imgur.com/8vx59mz.png';

const slobberBallImg = new Image();
slobberBallImg.src = 'https://cdn-icons-png.flaticon.com/512/616/616408.png';

// Preload function
function preloadImage(img, callback) {
  img.onload = () => {
    imagesLoaded++;
    if(imagesLoaded === totalImagesToLoad) {
      document.getElementById('loadingScreen').style.display = 'none';
      document.getElementById('startScreen').style.display = 'flex';
      // Set cat start position after images load
      catY = canvas.height/2 - catSize/2;
    }
    if(callback) callback();
  };
  img.onerror = () => {
    console.error('Image failed to load:', img.src);
  }
}

preloadImage(catImg);
dogImgsSrc.forEach(src=>{
  const img = new Image();
  img.src = src;
  dogImages.push(img);
  preloadImage(img);
});
preloadImage(coinImg);
preloadImage(toyImg);
preloadImage(dogBossImg);
preloadImage(slobberBallImg);

// Input
function flap(){
  if(gameOver){
    resetGame();
  } else {
    catVel = flapPower;
  }
}
document.addEventListener('keydown', e=>{
  if(e.code==='Space') flap();
});
canvas.addEventListener('mousedown', flap);
canvas.addEventListener('touchstart', e=>{
  e.preventDefault();
  flap();
});

// Game functions
function resetGame(){
  pipes = [];
  coins = [];
  toys = [];
  slobberBalls = [];
  barks = [];
  score = 0;
  level = 1;
  pipeSpeed = 3;
  pipeGap = 200;
  catY = canvas.height/2 - catSize/2;
  catVel = 0;
  gameOver = false;
  finalBossActive = false;
  finalBossHealth = finalBossHealthMax;
  started = true;
  addPipe();
  document.getElementById('startScreen').style.display = 'none';
}

function addPipe(){
  let topHeight = Math.random()*(canvas.height - pipeGap - 100) + 50;
  pipes.push({x: canvas.width, topHeight, passed:false});
  if(Math.random()<0.5){
    coins.push({x: canvas.width + pipeWidth/2, y: topHeight + pipeGap/2, collected:false});
  }
  if(level>=15 && Math.random()<0.1){
    toys.push({x: canvas.width + pipeWidth/2, y: topHeight + pipeGap/2, collected:false});
  }
}

function addSlobberBall(){
  if(!finalBossActive) return;
  slobberBalls.push({
    x: canvas.width - 160,
    y: 130 + Math.random()*100,
    size: 30,
    speed: 5 + level*0.2
  });
}

function addBark(){
  if(!finalBossActive) return;
  barks.push({
    x: canvas.width - 160,
    y: 100 + Math.random()*80,
    text: 'BARK!',
    alpha: 1,
    speed: 1
  });
}

function update(){
  if(!started || gameOver) return;

  catVel += gravity;
  catY += catVel;

  // Clamp cat position inside screen so it doesn't vanish
  if(catY < 0) {
    catY = 0;
    catVel = 0;
  }
  if(catY + catSize > canvas.height){
    catY = canvas.height - catSize;
    gameOver = true;
  }

  for(let i = pipes.length - 1; i >=0; i--){
    let p = pipes[i];
    p.x -= pipeSpeed;

    if(catX + catSize > p.x && catX < p.x + pipeWidth){
      if(catY < p.topHeight || catY + catSize > p.topHeight + pipeGap){
        gameOver = true;
      }
    }

    if(!p.passed && p.x + pipeWidth < catX){
      score++;
      p.passed = true;
      if(score % 10 === 0) levelUp();
    }

    if(p.x + pipeWidth < 0){
      pipes.splice(i,1);
    }
  }

  for(let i = coins.length-1; i >=0; i--){
    let c = coins[i];
    c.x -= pipeSpeed;
    if(!c.collected &&
      catX + catSize > c.x &&
      catX < c.x + 30 &&
      catY + catSize > c.y &&
      catY < c.y + 30){
      score++;
      c.collected = true;
      coins.splice(i,1);
    }
    else if(c.x < -40){
      coins.splice(i,1);
    }
  }

  for(let i = toys.length-1; i >=0; i--){
    let t = toys[i];
    t.x -= pipeSpeed;
    if(!t.collected &&
      catX + catSize > t.x &&
      catX < t.x + 30 &&
      catY + catSize > t.y &&
      catY < t.y + 30){
      t.collected = true;
      toys.splice(i,1);
      if(finalBossActive){
        finalBossHealth--;
        if(finalBossHealth <= 0){
          alert('You defeated the Final Boss! You Win! ðŸŽ‰');
          gameOver = true;
        }
      }
    }
    else if(t.x < -40){
      toys.splice(i,1);
    }
  }

  if(level === 10 && !finalBossActive){
    finalBossActive = 'level10';
  }
  if(level === 20 && finalBossActive !== 'final'){
    finalBossActive = 'final';
    finalBossHealth = finalBossHealthMax;
  }

  if(finalBossActive){
    if(Math.random() < 0.02) addSlobberBall();
    if(Math.random() < 0.01) addBark();
  }

  for(let i=slobberBalls.length-1; i>=0; i--){
    let s = slobberBalls[i];
    s.x -= s.speed;
    if(s.x < -50) slobberBalls.splice(i,1);
    else if(
      catX + catSize > s.x &&
      catX < s.x + s.size &&
      catY + catSize > s.y &&
      catY < s.y + s.size
    ){
      gameOver = true;
    }
  }

  for(let i=barks.length-1; i>=0; i--){
    let b = barks[i];
    b.x -= b.speed;
    b.alpha -= 0.02;
    if(b.alpha <= 0) barks.splice(i,1);
  }

  if(pipes.length === 0 || pipes[pipes.length-1].x < canvas.width - 300){
    addPipe();
  }

  if(level >= 5){
    pipeSpeed = 3 + (level - 4)*0.3;
    pipeGap = 200 - (level - 4)*5;
    if(pipeGap < 110) pipeGap = 110;
  }
}

function levelUp(){
  level++;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  pipes.forEach(p=>{
    ctx.fillStyle = '#654321';
    ctx.fillRect(p.x, 0, pipeWidth, p.topHeight);
    ctx.fillRect(p.x, p.topHeight + pipeGap, pipeWidth, canvas.height - (p.topHeight + pipeGap));

    let dogImg = dogImages[Math.floor(Math.random()*dogImages.length)];
    ctx.drawImage(dogImg, p.x - 40, p.topHeight - 80, 130, 130);
    ctx.drawImage(dogImg, p.x - 40, p.topHeight + pipeGap + 10, 130, 130);
  });

  coins.forEach(c=>{
    ctx.drawImage(coinImg, c.x, c.y, 30, 30);
  });

  toys.forEach(t=>{
    ctx.drawImage(toyImg, t.x, t.y, 30, 30);
  });

  if(finalBossActive === 'level10'){
    ctx.drawImage(dogBossImg, canvas.width - 180, 100, 180, 180);
  } else if(finalBossActive === 'final'){
    ctx.drawImage(dogBossImg, canvas.width - 180, 100, 180, 180);

    ctx.fillStyle = 'black';
    ctx.fillRect(canvas.width - 190, 90, 200, 20);

    ctx.fillStyle = 'limegreen';
    ctx.fillRect(canvas.width - 190, 90, 200 * (finalBossHealth / finalBossHealthMax), 20);

    ctx.fillStyle = 'white';
    ctx.font = '16px Arial';
    ctx.fillText(`Boss Health: ${finalBossHealth}`, canvas.width - 180, 105);

    slobberBalls.forEach(s=>{
      ctx.drawImage(slobberBallImg, s.x, s.y, s.size, s.size);
    });

    barks.forEach(b=>{
      ctx.globalAlpha = b.alpha;
      ctx.fillStyle = 'red';
      ctx.font = '30px Arial';
      ctx.fillText(b.text, b.x, b.y);
      ctx.globalAlpha = 1;
    });
  }

  ctx.drawImage(catImg, catX, catY, catSize, catSize);

  ctx.fillStyle = 'black';
  ctx.font = '28px Arial';
  ctx.fillText(`Score: ${score}`, 20, 40);
  ctx.fillText(`Level: ${level}`, 20, 75);
  ctx.fillText(`High Score: ${highScore}`, 20, 110);

  if(gameOver){
    ctx.fillStyle = 'red';
    ctx.font = '50px Arial';
    ctx.fillText('Game Over!', canvas.width/2 - 130, canvas.height/2);
    ctx.font = '24px Arial';
    ctx.fillText('Click or press SPACE to restart', canvas.width/2 - 160, canvas.height/2 + 50);

    if(score > highScore){
      highScore = score;
      localStorage.setItem('flappyCatHighScore', highScore);
    }
  }
}

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

function startGame(){
  resetGame();
  document.getElementById('startScreen').style.display = 'none';
}

gameLoop();
</script>

</body>
</html>
